# ìš´ì˜ìš© PC ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

## ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. ìš´ì˜ìš© PC ìš”êµ¬ì‚¬í•­
- **OS**: Ubuntu 20.04+ ë˜ëŠ” CentOS 8+
- **CPU**: 8ì½”ì–´ ì´ìƒ
- **RAM**: 32GB ì´ìƒ
- **Storage**: 500GB ì´ìƒ SSD
- **Network**: ê³ ì • IP, ë„ë©”ì¸ ì—°ê²° ê°€ëŠ¥

### 2. í•„ìš”í•œ ì†Œí”„íŠ¸ì›¨ì–´
- Docker Desktop 20.10+
- Kubernetes 1.24+
- kubectl 1.24+
- Git

## ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

### 1ë‹¨ê³„: Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶•

```bash
#!/bin/bash
# production-deploy.sh

echo "ğŸš€ ìš´ì˜ìš© PC ë°°í¬ ì‹œì‘..."

# Kubernetes í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™”
echo "ğŸ“¦ Kubernetes í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™” ì¤‘..."
sudo kubeadm init --pod-network-cidr=10.244.0.0/16

# kubeconfig ì„¤ì •
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ (Calico)
echo "ğŸŒ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ì¤‘..."
kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/calico.yaml

# MetalLB ì„¤ì¹˜
echo "ğŸ”— MetalLB ì„¤ì¹˜ ì¤‘..."
kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.12/config/manifests/metallb-native.yaml

# IPAddressPool ì„¤ì •
cat <<EOF | kubectl apply -f -
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: production-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.1.100-192.168.1.110  # ìš´ì˜ìš© IP ëŒ€ì—­
---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: production-l2
  namespace: metallb-system
spec:
  ipAddressPools:
  - production-pool
EOF

echo "âœ… Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ì™„ë£Œ!"
```

### 2ë‹¨ê³„: ArgoCD ì„¤ì¹˜ ë° ì„¤ì •

```bash
#!/bin/bash
# argocd-setup.sh

echo "ğŸ”„ ArgoCD ì„¤ì¹˜ ë° ì„¤ì • ì¤‘..."

# ArgoCD ì„¤ì¹˜
echo "ğŸ“¦ ArgoCD ì„¤ì¹˜ ì¤‘..."
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# ArgoCD ì„œë¹„ìŠ¤ íƒ€ì… ë³€ê²½ (LoadBalancer)
kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'

# ArgoCD ì¤€ë¹„ ëŒ€ê¸°
echo "â³ ArgoCD ì¤€ë¹„ ëŒ€ê¸° ì¤‘..."
kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=argocd-server -n argocd --timeout=300s

# ArgoCD Application ìƒì„± (GitOps ë ˆí¬ì§€í† ë¦¬ ì—°ê²°)
echo "ğŸ”— ArgoCD Application ìƒì„± ì¤‘..."
kubectl apply -f https://raw.githubusercontent.com/KORgosu/trip-currency-local-gitops/main/argocd/applications/trip-service-prod.yaml

# ArgoCD ì´ˆê¸° íŒ¨ìŠ¤ì›Œë“œ í™•ì¸
echo "ğŸ”‘ ArgoCD ì´ˆê¸° íŒ¨ìŠ¤ì›Œë“œ:"
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
echo ""

echo "âœ… ArgoCD ì„¤ì • ì™„ë£Œ!"
echo "ğŸŒ ArgoCD UI ì ‘ì†: http://<LoadBalancer-IP>:80"
```

### 3ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜

```bash
#!/bin/bash
# monitoring-setup.sh

echo "ğŸ“Š ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜ ì¤‘..."

# Prometheus + Grafana ì„¤ì¹˜
echo "ğŸ“ˆ Prometheus + Grafana ì„¤ì¹˜ ì¤‘..."
kubectl apply -f https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/main/bundle.yaml

# ELK Stack ì„¤ì¹˜
echo "ğŸ“ ELK Stack ì„¤ì¹˜ ì¤‘..."
kubectl apply -f https://raw.githubusercontent.com/elastic/cloud-on-k8s/main/config/recipes/elasticsearch/elasticsearch.yaml
kubectl apply -f https://raw.githubusercontent.com/elastic/cloud-on-k8s/main/config/recipes/kibana/kibana.yaml

# ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì¤€ë¹„ ëŒ€ê¸°
echo "â³ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì¤€ë¹„ ëŒ€ê¸° ì¤‘..."
kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=prometheus-operator -n default --timeout=300s
kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=elasticsearch -n default --timeout=300s

echo "âœ… ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜ ì™„ë£Œ!"
```

### 4ë‹¨ê³„: ì „ì²´ ë°°í¬ ì‹¤í–‰

```bash
#!/bin/bash
# full-deployment.sh

echo "ğŸš€ ì „ì²´ ë°°í¬ ì‹œì‘..."

# 1ë‹¨ê³„: Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶•
./production-deploy.sh

# 2ë‹¨ê³„: ArgoCD ì„¤ì¹˜ ë° ì„¤ì •
./argocd-setup.sh

# 3ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜
./monitoring-setup.sh

# 4ë‹¨ê³„: ë°°í¬ ìƒíƒœ í™•ì¸
echo "ğŸ” ë°°í¬ ìƒíƒœ í™•ì¸ ì¤‘..."
kubectl get all -A
kubectl get applications -n argocd

echo "âœ… ì „ì²´ ë°°í¬ ì™„ë£Œ!"
echo "ğŸŒ ì ‘ì† URL:"
echo "   - ArgoCD: http://<LoadBalancer-IP>:80"
echo "   - Grafana: http://<LoadBalancer-IP>:3000"
echo "   - Kibana: http://<LoadBalancer-IP>:5601"
```

## ë°°í¬ í›„ í™•ì¸ì‚¬í•­

### 1. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
```bash
# ì „ì²´ ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸
kubectl get all -A

# ArgoCD Application ìƒíƒœ í™•ì¸
kubectl get applications -n argocd

# Trip Service íŒŒë“œ ìƒíƒœ í™•ì¸
kubectl get pods -n trip-service-prod
```

### 2. ë¡œê·¸ í™•ì¸
```bash
# Trip Service ë¡œê·¸ í™•ì¸
kubectl logs -l app=service-frontend -n trip-service-prod
kubectl logs -l app=service-currency -n trip-service-prod
kubectl logs -l app=service-history -n trip-service-prod
kubectl logs -l app=service-ranking -n trip-service-prod
```

### 3. ëª¨ë‹ˆí„°ë§ í™•ì¸
```bash
# Prometheus ë©”íŠ¸ë¦­ í™•ì¸
kubectl port-forward svc/prometheus-operated 9090:9090

# Grafana ëŒ€ì‹œë³´ë“œ í™•ì¸
kubectl port-forward svc/grafana 3000:3000

# Kibana ë¡œê·¸ í™•ì¸
kubectl port-forward svc/kibana 5601:5601
```

## ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸

### 1. ê°œë°œ PCì—ì„œ ì½”ë“œ ë³€ê²½
```bash
# ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ í›„ í‘¸ì‹œ
git add .
git commit -m "Test production deployment"
git push origin main
```

### 2. ìš´ì˜ìš© PCì—ì„œ ìë™ ë°°í¬ í™•ì¸
```bash
# ArgoCDì—ì„œ ë³€ê²½ì‚¬í•­ ê°ì§€ í™•ì¸
kubectl get applications -n argocd

# ìƒˆë¡œìš´ íŒŒë“œ ë°°í¬ í™•ì¸
kubectl get pods -n trip-service-prod
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
- **ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ**: ë°©í™”ë²½ ì„¤ì • í™•ì¸
- **ë¦¬ì†ŒìŠ¤ ë¶€ì¡±**: ë…¸ë“œ ë¦¬ì†ŒìŠ¤ í™•ì¸
- **ì´ë¯¸ì§€ Pull ì‹¤íŒ¨**: Docker Registry ì¸ì¦ í™•ì¸

### 2. ë¡œê·¸ í™•ì¸
```bash
# ArgoCD ë¡œê·¸
kubectl logs -n argocd deployment/argocd-application-controller

# Trip Service ë¡œê·¸
kubectl logs -n trip-service-prod deployment/service-frontend
```

### 3. ìƒíƒœ í™•ì¸
```bash
# ì´ë²¤íŠ¸ í™•ì¸
kubectl get events -n trip-service-prod --sort-by='.lastTimestamp'

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top pods -n trip-service-prod
```

## ë³´ì•ˆ ì„¤ì •

### 1. TLS ì¸ì¦ì„œ ì„¤ì •
```bash
# cert-manager ì„¤ì¹˜
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml

# Let's Encrypt ClusterIssuer ìƒì„±
kubectl apply -f - <<EOF
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: your-email@example.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: nginx
EOF
```

### 2. ë„¤íŠ¸ì›Œí¬ ì •ì±… ì„¤ì •
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: trip-service-network-policy
  namespace: trip-service-prod
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
  egress:
  - to: []
    ports:
    - protocol: TCP
      port: 53
    - protocol: UDP
      port: 53
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
- CPU: 500m ~ 1000m
- Memory: 512Mi ~ 1Gi
- HPA ì„¤ì •ìœ¼ë¡œ ìë™ ìŠ¤ì¼€ì¼ë§

### 2. ìºì‹± ì „ëµ
- Redis í´ëŸ¬ìŠ¤í„° êµ¬ì„±
- CDN ì„¤ì • (CloudFlare ë“±)

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
- ì¸ë±ìŠ¤ ì„¤ì •
- ì¿¼ë¦¬ ìµœì í™”
- ì—°ê²° í’€ ì„¤ì •
